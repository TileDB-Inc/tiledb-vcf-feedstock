{% set name = "tiledb-vcf" %}
{% set version = "0.21.0" %}
{% set sha256 = "b7e24ff54a158905bdbab300bd6633f210e00f20e66f7cfa6de2fc1259e67962" %}

package:
  name: {{ name }}
  version: {{ version }}

source:
  #git_url: https://github.com/TileDB-Inc/TileDB-VCF.git
  #git_rev: {{ version }}
  #fn: {{ name }}-{{ version }}.tar.gz
  #url: https://pypi.io/packages/source/{{ name[0] }}/{{ name }}/{{ name }}-{{ version }}.tar.gz
  url: https://github.com/TileDB-Inc/TileDB-VCF/archive/{{ version }}.tar.gz
  sha256: {{ sha256 }}
  patches:
    - 0001-htslib-build.patch

build:
  number: 3
  skip: true  # [win or linux32 or py2k]

requirements:
  build:
    - {{ compiler('c') }}
    - {{ compiler('cxx') }}
    - git
    - cmake
    - make
    - autoconf
    - automake
  run:
    - tiledb 2.13.*
  host:
    - tiledb 2.13.*
outputs:
  - name: libtiledbvcf
    version: {{ version }}
    script: install-libtiledbvcf.sh
    requirements:
      build:
        - {{ compiler('c') }}
        - {{ compiler('cxx') }}
        - cmake
        - make
        - autoconf
        - automake
      host:
        - tiledb 2.13.*
        # htslib build requirements
        - bzip2
        - xz
        - zlib
        - libdeflate
      run:
        - tiledb 2.13.*
        # htslib build requirements
        - bzip2
        - xz
        - zlib
        - libdeflate
    test:
      commands:
        - tiledbvcf version

  - name: tiledbvcf-py
    version: {{ version }}
    script: build-tiledbvcf-py.sh
    requirements:
      build:
        - {{ compiler('c') }}
        - {{ compiler('cxx') }}
        - cmake
        - make
        - python                              # [build_platform != target_platform]
        - cross-python_{{ target_platform }}  # [build_platform != target_platform]
        - numpy                               # [build_platform != target_platform]
      host:
        - {{ pin_compatible('numpy', lower_bound='1.16') }}
        - {{ pin_subpackage('libtiledbvcf', exact=True) }}
        - python
        - pyarrow 9.0.*
        - pybind11
        - rpdb
        - wheel
        - setuptools
        - setuptools_scm 6.0.1
        - setuptools_scm_git_archive
      run:
        - {{ pin_compatible('numpy', lower_bound='1.16') }}
        - {{ pin_subpackage('libtiledbvcf', exact=True) }}
        - python
        - pyarrow 9.0.*
        - pybind11
        - setuptools
        - pandas
    imports:
      - tiledbvcf
    test:
      commands:
        - python -c "import tiledbvcf; tiledbvcf.version"

about:
  home: http://tiledb.com
  license: MIT
  license_family: MIT
  license_file: LICENSE
  summary: 'Efficient variant-call data storage and retrieval library using the TileDB storage library.'
  description: |
    TileDB-VCF is the python interface to the TileDB-VCF library.
  doc_url: https://docs.tiledb.com/developer/tiledbvcf/introduction
  dev_url: https://github.com/TileDB-Inc/TileDB-VCF

extra:
  recipe-maintainers:
    - ihnorton
    - shelnutt2
